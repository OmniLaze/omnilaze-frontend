App({onLaunch(){console.log('AI外卖助手小程序启动');this.chkUp();this.getSysInfo();this.initUsr();},onShow(){console.log('AI外卖助手进入前台');},onHide(){console.log('AI外卖助手进入后台');},onError(m){console.error('小程序错误:',m);},chkUp(){if(wx.canIUse('getUpdateManager')){const u=wx.getUpdateManager();u.onCheckForUpdate((r)=>{if(r.hasUpdate)console.log('发现新版本，准备更新');});u.onUpdateReady(()=>{wx.showModal({title:'更新提示',content:'新版本已经准备好，是否重启应用？',success:(r)=>{if(r.confirm)u.applyUpdate();}});});u.onUpdateFailed(()=>{console.error('新版本下载失败');});}},getSysInfo(){wx.getSystemInfo({success:(r)=>{this.globalData.systemInfo=r;console.log('系统信息:',r);},fail:(e)=>{console.error('获取系统信息失败:',e);}});},initUsr(){const u=wx.getStorageSync('userPreferences');if(u)this.globalData.userPreferences=u;const o=wx.getStorageSync('orderHistory');if(o)this.globalData.orderHistory=o;},saveUserPreferences(p){this.globalData.userPreferences={...this.globalData.userPreferences,...p};wx.setStorageSync('userPreferences',this.globalData.userPreferences);},addOrderToHistory(o){if(!this.globalData.orderHistory)this.globalData.orderHistory=[];this.globalData.orderHistory.unshift({...o,id:Date.now(),timestamp:new Date().toISOString()});if(this.globalData.orderHistory.length>20)this.globalData.orderHistory=this.globalData.orderHistory.slice(0,20);wx.setStorageSync('orderHistory',this.globalData.orderHistory);},globalData:{systemInfo:null,userPreferences:{defaultBudget:'',favoriteRestaurants:[],allergens:[],deliveryAddresses:[]},orderHistory:[],apiBaseUrl:'https://your-api-domain.com',userInfo:null,hasUserInfo:false}});