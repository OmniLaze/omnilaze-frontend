<!--透明管家式AI点餐助手-->
<view class="chat-container theme-warm-glass">

  <!-- 居中的智能预设标签 -->
  <view class="center-content">
    <view wx:if="{{autoDetectedTime || autoBudget}}" class="smart-preset-container-center">
      <!-- 金属质感标题 -->
      <view class="metallic-title">
        <text class="metallic-text">不知道吃啥？懒得点？「懒得」替你点外卖</text>
      </view>
      
      <view class="smart-preset-tag-large dynamic-glass breathing">
        <text class="preset-label">默认：</text>立即下单
        <text class="preset-line">预算{{autoBudget}}¥</text>
        <text class="preset-line">无忌口和过敏源</text>
      </view>
    </view>
  </view>

  <!-- 信息流区域 -->
  <scroll-view 
    class="information-flow {{showMainInput ? 'with-input' : 'no-input'}}" 
    scroll-y="true" 
    scroll-top="{{scrollTop}}"
    scroll-into-view="{{scrollIntoView}}"
    enable-flex="true"
  >
    <!-- 通知卡片列表 -->
    <view 
      wx:for="{{notifications}}" 
      wx:key="id" 
      class="notification-item {{item.type}}" 
      id="notification-{{item.id}}"
    >
      <!-- AI管家通知 -->
      <view wx:if="{{item.type === 'notification'}}" class="agent-message">
        <view class="message-bubble agent-bubble">
          <text class="message-text">{{item.content}}</text>
        </view>
      </view>

      <!-- 用户输入回显 -->
      <view wx:if="{{item.type === 'user-echo'}}" class="user-message">
        <view class="message-bubble user-bubble">
          <text class="message-text">{{item.content}}</text>
        </view>
      </view>

      <!-- 结果通知卡片 -->
      <view wx:if="{{item.type === 'result-notification'}}" class="agent-message">
        <view class="message-bubble agent-bubble">
          <text class="message-text">已为您找到心仪外卖：{{item.dishName}} · {{item.restaurant}}</text>
          
          <!-- 自动确认倒计时 -->
          <view wx:if="{{item.showCountdown}}" class="countdown-container">
            <view class="countdown-circle">
              <text class="countdown-number">{{item.countdown}}</text>
            </view>
            <text class="countdown-text">秒后自动为您下单</text>
          </view>
          
          <!-- 详情展示（可选展开） -->
          <view wx:if="{{item.showDetails}}" class="dish-details-preview">
            <text class="dish-price">¥{{item.price}}</text>
            <text class="delivery-time">{{item.deliveryTime}}送达</text>
          </view>
        </view>
      </view>

    </view>

    <!-- AI工作状态指示器 - 呼吸点动画 -->
    <view wx:if="{{showWorkingIndicator}}" class="working-indicator">
      <view class="working-status">
        <view class="loading-dots">
          <view class="loading-dot"></view>
          <view class="loading-dot"></view>
          <view class="loading-dot"></view>
        </view>
        <text class="working-text">{{workingText}}</text>
      </view>
    </view>
  </scroll-view>

  <!-- 中央文案 -->
  <view class="center-text">
    <text class="center-line">不知道吃啥？</text>
    <text class="center-line">懒得点？</text>
    <text class="center-line">让「懒得」帮你点外卖</text>
  </view>

  <!-- 底部提示文字 -->
  <view class="bottom-hint" wx:if="{{showMainInput}}">
    <text class="hint-text">有忌口？或者想指定时间或预算，可用自然语言告诉我哟</text>
  </view>

  <!-- 漂浮的智能输入框 -->
  <input 
    wx:if="{{showMainInput}}"
    class="smart-input-field touch-feedback"
    placeholder="{{dynamicPlaceholder}}"
    value="{{mainInputValue}}"
    bindinput="onMainInput"
    bindfocus="onMainInputFocus"
    bindblur="onMainInputBlur"
    bindconfirm="submitMainInput"
    bindenabledinput="onMainInputenable"
    bindtap="focusInput"
    focus="{{mainInputFocus}}"
    confirm-type="send"
    cursor-spacing="20"
    adjust-position="{{true}}"
    maxlength="200"
    auto-focus="{{false}}"
    selection-start="-1"
    selection-end="-1"
  />

  <!-- 全局涟漪效果容器 -->
  <view class="ripple-container" wx:if="{{showRippleEffect}}"></view>
</view>
